{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///E:/oyechatorocomingsoon/app/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\nimport { PrismaNeon } from '@prisma/adapter-neon';\r\nimport { neonConfig } from '@neondatabase/serverless';\r\n\r\n// Prisma Client singleton for Next.js\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClient | undefined;\r\n};\r\n\r\n// Lazy initialization function\r\nfunction createPrismaClient(): PrismaClient {\r\n    const connectionString = process.env.DATABASE_URL;\r\n\r\n    if (!connectionString) {\r\n        throw new Error('DATABASE_URL environment variable is not set');\r\n    }\r\n\r\n    // Only configure WebSocket in Node.js environment (not edge/browser)\r\n    if (typeof window === 'undefined') {\r\n        // Dynamic import ws only on server\r\n        try {\r\n            // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n            const ws = require('ws');\r\n            neonConfig.webSocketConstructor = ws;\r\n        } catch {\r\n            // In edge runtime, ws is not available - use fetch instead\r\n            neonConfig.poolQueryViaFetch = true;\r\n        }\r\n    }\r\n\r\n    const adapter = new PrismaNeon({ connectionString });\r\n    return new PrismaClient({ adapter });\r\n}\r\n\r\n// Get or create Prisma client\r\nexport function getPrisma(): PrismaClient {\r\n    if (!globalForPrisma.prisma) {\r\n        globalForPrisma.prisma = createPrismaClient();\r\n    }\r\n    return globalForPrisma.prisma;\r\n}\r\n\r\n// Export a getter that lazily creates the client\r\nexport const prisma = new Proxy({} as PrismaClient, {\r\n    get(_target, prop) {\r\n        return getPrisma()[prop as keyof PrismaClient];\r\n    },\r\n});\r\n\r\nexport default prisma;\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAEA,sCAAsC;AACtC,MAAM,kBAAkB;AAIxB,+BAA+B;AAC/B,SAAS;IACL,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IAEjD,IAAI,CAAC,kBAAkB;QACnB,MAAM,IAAI,MAAM;IACpB;IAEA,qEAAqE;IACrE,wCAAmC;QAC/B,mCAAmC;QACnC,IAAI;YACA,iEAAiE;YACjE,MAAM;YACN,sKAAU,CAAC,oBAAoB,GAAG;QACtC,EAAE,OAAM;YACJ,2DAA2D;YAC3D,sKAAU,CAAC,iBAAiB,GAAG;QACnC;IACJ;IAEA,MAAM,UAAU,IAAI,6KAAU,CAAC;QAAE;IAAiB;IAClD,OAAO,IAAI,6IAAY,CAAC;QAAE;IAAQ;AACtC;AAGO,SAAS;IACZ,IAAI,CAAC,gBAAgB,MAAM,EAAE;QACzB,gBAAgB,MAAM,GAAG;IAC7B;IACA,OAAO,gBAAgB,MAAM;AACjC;AAGO,MAAM,SAAS,IAAI,MAAM,CAAC,GAAmB;IAChD,KAAI,OAAO,EAAE,IAAI;QACb,OAAO,WAAW,CAAC,KAA2B;IAClD;AACJ;uCAEe"}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///E:/oyechatorocomingsoon/app/api/customers/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { prisma } from '@/app/lib/db';\r\n\r\n// GET all customers\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const search = searchParams.get('search');\r\n        const limit = parseInt(searchParams.get('limit') || '100');\r\n\r\n        const customers = await prisma.customer.findMany({\r\n            where: search ? {\r\n                OR: [\r\n                    { name: { contains: search, mode: 'insensitive' } },\r\n                    { phone: { contains: search } },\r\n                ],\r\n            } : undefined,\r\n            orderBy: { lastVisit: 'desc' },\r\n            take: limit,\r\n        });\r\n\r\n        return NextResponse.json(customers);\r\n    } catch (error) {\r\n        console.error('Error fetching customers:', error);\r\n        return NextResponse.json({ error: 'Failed to fetch customers' }, { status: 500 });\r\n    }\r\n}\r\n\r\n// POST create/update customer\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // Upsert - create or update based on phone\r\n        const customer = await prisma.customer.upsert({\r\n            where: { phone: body.phone },\r\n            update: {\r\n                name: body.name,\r\n                email: body.email,\r\n                totalOrders: { increment: body.orderTotal ? 1 : 0 },\r\n                totalSpent: { increment: body.orderTotal || 0 },\r\n                loyaltyPoints: { increment: Math.floor((body.orderTotal || 0) / 100) },\r\n                lastVisit: new Date(),\r\n            },\r\n            create: {\r\n                name: body.name,\r\n                phone: body.phone,\r\n                email: body.email,\r\n                totalOrders: 1,\r\n                totalSpent: body.orderTotal || 0,\r\n                loyaltyPoints: Math.floor((body.orderTotal || 0) / 100),\r\n            },\r\n        });\r\n\r\n        return NextResponse.json(customer, { status: 201 });\r\n    } catch (error) {\r\n        console.error('Error creating customer:', error);\r\n        return NextResponse.json({ error: 'Failed to create customer' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QAEpD,MAAM,YAAY,MAAM,4HAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC7C,OAAO,SAAS;gBACZ,IAAI;oBACA;wBAAE,MAAM;4BAAE,UAAU;4BAAQ,MAAM;wBAAc;oBAAE;oBAClD;wBAAE,OAAO;4BAAE,UAAU;wBAAO;oBAAE;iBACjC;YACL,IAAI;YACJ,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;QACV;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACJ;AAGO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2CAA2C;QAC3C,MAAM,WAAW,MAAM,4HAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC1C,OAAO;gBAAE,OAAO,KAAK,KAAK;YAAC;YAC3B,QAAQ;gBACJ,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,aAAa;oBAAE,WAAW,KAAK,UAAU,GAAG,IAAI;gBAAE;gBAClD,YAAY;oBAAE,WAAW,KAAK,UAAU,IAAI;gBAAE;gBAC9C,eAAe;oBAAE,WAAW,KAAK,KAAK,CAAC,CAAC,KAAK,UAAU,IAAI,CAAC,IAAI;gBAAK;gBACrE,WAAW,IAAI;YACnB;YACA,QAAQ;gBACJ,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,OAAO,KAAK,KAAK;gBACjB,aAAa;gBACb,YAAY,KAAK,UAAU,IAAI;gBAC/B,eAAe,KAAK,KAAK,CAAC,CAAC,KAAK,UAAU,IAAI,CAAC,IAAI;YACvD;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACJ"}}]
}