{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/oyechatorocomingsoon/app/dashboard/kitchen/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { useOrders } from '../../lib/storage';\r\n\r\nexport default function KitchenPage() {\r\n    const { orders, updateStatus } = useOrders();\r\n    const [viewMode, setViewMode] = useState<'tickets' | 'items'>('tickets');\r\n    const [currentTime, setCurrentTime] = useState(Date.now());\r\n    const [isSoundEnabled, setIsSoundEnabled] = useState(true);\r\n    const prevOrderCountRef = useRef(0);\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    // Filter for active orders (Pending or Cooking)\r\n    const activeOrders = orders.filter(o => o.status === 'Pending' || o.status === 'Cooking').sort((a, b) => a.id - b.id);\r\n\r\n    // --- Timer Logic ---\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setCurrentTime(Date.now()), 10000); // Update every 10s\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    const getElapsedTime = (order: any) => {\r\n        if (order.status === 'Pending') {\r\n            // For pending orders, maybe show \"Waiting\" or time since placed\r\n            const diff = currentTime - order.id; // Fallback to ID as timestamp\r\n            return Math.floor(diff / 60000);\r\n        }\r\n        if (order.status === 'Cooking' && order.cookingStartedAt) {\r\n            const diff = currentTime - order.cookingStartedAt;\r\n            return Math.floor(diff / 60000);\r\n        }\r\n        return 0;\r\n    };\r\n\r\n    const getStatusColor = (minutes: number) => {\r\n        if (minutes < 10) return 'bg-green-100 text-green-800 border-green-200';\r\n        if (minutes < 20) return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n        return 'bg-red-100 text-red-800 border-red-200 animate-pulse';\r\n    };\r\n\r\n    // --- Sound Logic ---\r\n    useEffect(() => {\r\n        // Initialize Audio Context on first interaction if needed, or just use simple Audio for now\r\n        // Using the same robust AudioContext method as Orders page\r\n        const playSound = () => {\r\n            try {\r\n                const AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n                if (!AudioContext) return;\r\n                const ctx = new AudioContext();\r\n                const osc = ctx.createOscillator();\r\n                const gain = ctx.createGain();\r\n                osc.connect(gain);\r\n                gain.connect(ctx.destination);\r\n                osc.type = 'square'; // harsher sound for kitchen\r\n                osc.frequency.setValueAtTime(600, ctx.currentTime);\r\n                osc.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.5);\r\n                gain.gain.setValueAtTime(0.3, ctx.currentTime);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\r\n                osc.start();\r\n                osc.stop(ctx.currentTime + 0.5);\r\n            } catch (e) { console.error(e); }\r\n        };\r\n\r\n        if (activeOrders.length > prevOrderCountRef.current) {\r\n            if (isSoundEnabled) playSound();\r\n        }\r\n        prevOrderCountRef.current = activeOrders.length;\r\n    }, [activeOrders.length, isSoundEnabled]);\r\n\r\n    // --- Item Aggregation Logic ---\r\n    const aggregatedItems = activeOrders.reduce((acc: { [key: string]: number }, order) => {\r\n        order.items.forEach((item: string) => {\r\n            // Clean item name (remove existing qty if present, though usually stored as \"Name\")\r\n            // Assuming item string is just \"Name\" or \"Name (Qty)\"\r\n            // For this logic, we'll just count the raw strings or try to parse\r\n            acc[item] = (acc[item] || 0) + 1;\r\n        });\r\n        return acc;\r\n    }, {});\r\n\r\n    // --- KOT Print ---\r\n    const printKOT = (order: any) => {\r\n        const content = `\r\n            <html>\r\n            <head>\r\n                <title>KOT #${order.id}</title>\r\n                <style>\r\n                    body { font-family: monospace; padding: 20px; max-width: 300px; }\r\n                    .header { font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 10px; }\r\n                    .meta { font-size: 14px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }\r\n                    .item { font-size: 18px; font-weight: bold; margin-bottom: 10px; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <div class=\"header\">KITCHEN TICKET</div>\r\n                <div class=\"meta\">\r\n                    #${order.id}<br>\r\n                    ${order.time}<br>\r\n                    ${order.type}\r\n                </div>\r\n                ${order.items.map((item: string) => `<div class=\"item\">‚ñ° ${item}</div>`).join('')}\r\n                <script>window.print();</script>\r\n            </body>\r\n            </html>\r\n        `;\r\n        const win = window.open('', '', 'width=300,height=600');\r\n        if (win) {\r\n            win.document.write(content);\r\n            win.document.close();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-4 h-full flex flex-col min-h-screen bg-gray-50\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-center mb-6 gap-4 animate-in\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-[var(--brand-dark)]\">üë®‚Äçüç≥ Kitchen Display</h1>\r\n                    <p className=\"text-[var(--text-muted)]\">Live Order Tracking</p>\r\n                </div>\r\n\r\n                <div className=\"flex gap-4 items-center\">\r\n                    {/* View Toggle */}\r\n                    <div className=\"bg-white p-1 rounded-xl border border-gray-200 flex\">\r\n                        <button\r\n                            onClick={() => setViewMode('tickets')}\r\n                            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'tickets' ? 'bg-[var(--brand-primary)] text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                        >\r\n                            üé´ Tickets\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('items')}\r\n                            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'items' ? 'bg-[var(--brand-primary)] text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                        >\r\n                            üçî Items\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Sound Toggle */}\r\n                    <button\r\n                        onClick={() => setIsSoundEnabled(!isSoundEnabled)}\r\n                        className={`p-3 rounded-xl border transition-colors ${isSoundEnabled ? 'bg-white text-[var(--brand-primary)] border-[var(--brand-primary)]' : 'bg-gray-100 text-gray-400 border-gray-200'}`}\r\n                    >\r\n                        {isSoundEnabled ? 'üîî' : 'üîï'}\r\n                    </button>\r\n\r\n                    {/* Active Count */}\r\n                    <div className=\"bg-[var(--brand-dark)] text-white px-6 py-2 rounded-xl text-center\">\r\n                        <div className=\"text-2xl font-bold leading-none\">{activeOrders.length}</div>\r\n                        <div className=\"text-[10px] uppercase tracking-wider opacity-80\">Pending</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            {activeOrders.length === 0 ? (\r\n                <div className=\"flex-1 flex flex-col items-center justify-center text-[var(--text-muted)] animate-in\">\r\n                    <div className=\"text-8xl mb-6 opacity-20\">üë®‚Äçüç≥</div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-400\">All Caught Up!</h2>\r\n                    <p className=\"text-gray-400\">Kitchen is clear.</p>\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {viewMode === 'tickets' ? (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in\">\r\n                            {activeOrders.map((order) => {\r\n                                const elapsed = getElapsedTime(order);\r\n                                const statusColor = getStatusColor(elapsed);\r\n\r\n                                return (\r\n                                    <div key={order.id} className={`bg-white rounded-2xl shadow-sm border-2 flex flex-col overflow-hidden transition-all hover:shadow-md ${order.status === 'Pending' ? 'border-yellow-400' : 'border-blue-500'}`}>\r\n                                        {/* Card Header */}\r\n                                        <div className={`p-4 flex justify-between items-start border-b ${statusColor}`}>\r\n                                            <div>\r\n                                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                                    <span className=\"font-bold text-lg\">#{order.id.toString().slice(-4)}</span>\r\n                                                    <span className=\"text-[10px] uppercase font-bold px-2 py-0.5 bg-white/50 rounded\">{order.type}</span>\r\n                                                </div>\r\n                                                <div className=\"text-xs font-mono opacity-80\">{order.time}</div>\r\n                                            </div>\r\n                                            <div className=\"text-right\">\r\n                                                <div className=\"text-2xl font-bold leading-none\">{elapsed}m</div>\r\n                                                <div className=\"text-[10px] uppercase font-bold opacity-80\">{order.status === 'Cooking' ? 'Cooking' : 'Waiting'}</div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Items */}\r\n                                        <div className=\"p-4 flex-1 space-y-3\">\r\n                                            {order.items.map((item: string, idx: number) => (\r\n                                                <div key={idx} className=\"flex items-start gap-3 text-lg font-bold text-gray-800\">\r\n                                                    <span className=\"mt-1.5 w-2 h-2 rounded-full bg-gray-300 shrink-0\"></span>\r\n                                                    <span className=\"leading-tight\">{item}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n\r\n                                        {/* Actions */}\r\n                                        <div className=\"p-4 bg-gray-50 border-t flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => printKOT(order)}\r\n                                                className=\"p-3 bg-white border border-gray-200 rounded-xl text-gray-500 hover:bg-gray-100\"\r\n                                                title=\"Print KOT\"\r\n                                            >\r\n                                                üñ®Ô∏è\r\n                                            </button>\r\n                                            {order.status === 'Pending' ? (\r\n                                                <button\r\n                                                    onClick={() => updateStatus(order.id, 'Cooking')}\r\n                                                    className=\"flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-200 transition-all\"\r\n                                                >\r\n                                                    Start Cooking\r\n                                                </button>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={() => updateStatus(order.id, 'Ready')}\r\n                                                    className=\"flex-1 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold shadow-lg shadow-green-200 transition-all\"\r\n                                                >\r\n                                                    Mark Ready\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 animate-in\">\r\n                            {Object.entries(aggregatedItems).map(([item, count]) => (\r\n                                <div key={item} className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center text-center hover:shadow-md transition-all\">\r\n                                    <div className=\"text-5xl font-bold text-[var(--brand-primary)] mb-2\">{count}</div>\r\n                                    <div className=\"text-lg font-bold text-gray-800 leading-tight\">{item}</div>\r\n                                    <div className=\"mt-4 text-xs text-gray-400 uppercase tracking-wider font-bold\">To Prepare</div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}