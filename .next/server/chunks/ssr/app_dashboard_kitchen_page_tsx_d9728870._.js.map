{"version":3,"sources":["../../../../app/dashboard/kitchen/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { useOrders } from '../../lib/storage';\r\n\r\nexport default function KitchenPage() {\r\n    const { orders, updateStatus } = useOrders();\r\n    const [viewMode, setViewMode] = useState<'tickets' | 'items'>('tickets');\r\n    const [currentTime, setCurrentTime] = useState(Date.now());\r\n    const [isSoundEnabled, setIsSoundEnabled] = useState(true);\r\n    const prevOrderCountRef = useRef(0);\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    // Filter for active orders (Pending or Cooking)\r\n    const activeOrders = orders.filter(o => o.status === 'Pending' || o.status === 'Cooking').sort((a, b) => a.id - b.id);\r\n\r\n    // --- Timer Logic ---\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setCurrentTime(Date.now()), 10000); // Update every 10s\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    const getElapsedTime = (order: any) => {\r\n        if (order.status === 'Pending') {\r\n            // For pending orders, maybe show \"Waiting\" or time since placed\r\n            const diff = currentTime - order.id; // Fallback to ID as timestamp\r\n            return Math.floor(diff / 60000);\r\n        }\r\n        if (order.status === 'Cooking' && order.cookingStartedAt) {\r\n            const diff = currentTime - order.cookingStartedAt;\r\n            return Math.floor(diff / 60000);\r\n        }\r\n        return 0;\r\n    };\r\n\r\n    const getStatusColor = (minutes: number) => {\r\n        if (minutes < 10) return 'bg-green-100 text-green-800 border-green-200';\r\n        if (minutes < 20) return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n        return 'bg-red-100 text-red-800 border-red-200 animate-pulse';\r\n    };\r\n\r\n    // --- Sound Logic ---\r\n    useEffect(() => {\r\n        // Initialize Audio Context on first interaction if needed, or just use simple Audio for now\r\n        // Using the same robust AudioContext method as Orders page\r\n        const playSound = () => {\r\n            try {\r\n                const AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n                if (!AudioContext) return;\r\n                const ctx = new AudioContext();\r\n                const osc = ctx.createOscillator();\r\n                const gain = ctx.createGain();\r\n                osc.connect(gain);\r\n                gain.connect(ctx.destination);\r\n                osc.type = 'square'; // harsher sound for kitchen\r\n                osc.frequency.setValueAtTime(600, ctx.currentTime);\r\n                osc.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.5);\r\n                gain.gain.setValueAtTime(0.3, ctx.currentTime);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\r\n                osc.start();\r\n                osc.stop(ctx.currentTime + 0.5);\r\n            } catch (e) { console.error(e); }\r\n        };\r\n\r\n        if (activeOrders.length > prevOrderCountRef.current) {\r\n            if (isSoundEnabled) playSound();\r\n        }\r\n        prevOrderCountRef.current = activeOrders.length;\r\n    }, [activeOrders.length, isSoundEnabled]);\r\n\r\n    // --- Item Aggregation Logic ---\r\n    const aggregatedItems = activeOrders.reduce((acc: { [key: string]: number }, order) => {\r\n        order.items.forEach((item: string) => {\r\n            // Clean item name (remove existing qty if present, though usually stored as \"Name\")\r\n            // Assuming item string is just \"Name\" or \"Name (Qty)\"\r\n            // For this logic, we'll just count the raw strings or try to parse\r\n            acc[item] = (acc[item] || 0) + 1;\r\n        });\r\n        return acc;\r\n    }, {});\r\n\r\n    // --- KOT Print ---\r\n    const printKOT = (order: any) => {\r\n        const content = `\r\n            <html>\r\n            <head>\r\n                <title>KOT #${order.id}</title>\r\n                <style>\r\n                    body { font-family: monospace; padding: 20px; max-width: 300px; }\r\n                    .header { font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 10px; }\r\n                    .meta { font-size: 14px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }\r\n                    .item { font-size: 18px; font-weight: bold; margin-bottom: 10px; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <div class=\"header\">KITCHEN TICKET</div>\r\n                <div class=\"meta\">\r\n                    #${order.id}<br>\r\n                    ${order.time}<br>\r\n                    ${order.type}\r\n                </div>\r\n                ${order.items.map((item: string) => `<div class=\"item\">‚ñ° ${item}</div>`).join('')}\r\n                <script>window.print();</script>\r\n            </body>\r\n            </html>\r\n        `;\r\n        const win = window.open('', '', 'width=300,height=600');\r\n        if (win) {\r\n            win.document.write(content);\r\n            win.document.close();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-4 h-full flex flex-col min-h-screen bg-gray-50\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-center mb-6 gap-4 animate-in\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-[var(--brand-dark)]\">üë®‚Äçüç≥ Kitchen Display</h1>\r\n                    <p className=\"text-[var(--text-muted)]\">Live Order Tracking</p>\r\n                </div>\r\n\r\n                <div className=\"flex gap-4 items-center\">\r\n                    {/* View Toggle */}\r\n                    <div className=\"bg-white p-1 rounded-xl border border-gray-200 flex\">\r\n                        <button\r\n                            onClick={() => setViewMode('tickets')}\r\n                            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'tickets' ? 'bg-[var(--brand-primary)] text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                        >\r\n                            üé´ Tickets\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('items')}\r\n                            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'items' ? 'bg-[var(--brand-primary)] text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                        >\r\n                            üçî Items\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Sound Toggle */}\r\n                    <button\r\n                        onClick={() => setIsSoundEnabled(!isSoundEnabled)}\r\n                        className={`p-3 rounded-xl border transition-colors ${isSoundEnabled ? 'bg-white text-[var(--brand-primary)] border-[var(--brand-primary)]' : 'bg-gray-100 text-gray-400 border-gray-200'}`}\r\n                    >\r\n                        {isSoundEnabled ? 'üîî' : 'üîï'}\r\n                    </button>\r\n\r\n                    {/* Active Count */}\r\n                    <div className=\"bg-[var(--brand-dark)] text-white px-6 py-2 rounded-xl text-center\">\r\n                        <div className=\"text-2xl font-bold leading-none\">{activeOrders.length}</div>\r\n                        <div className=\"text-[10px] uppercase tracking-wider opacity-80\">Pending</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            {activeOrders.length === 0 ? (\r\n                <div className=\"flex-1 flex flex-col items-center justify-center text-[var(--text-muted)] animate-in\">\r\n                    <div className=\"text-8xl mb-6 opacity-20\">üë®‚Äçüç≥</div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-400\">All Caught Up!</h2>\r\n                    <p className=\"text-gray-400\">Kitchen is clear.</p>\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {viewMode === 'tickets' ? (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in\">\r\n                            {activeOrders.map((order) => {\r\n                                const elapsed = getElapsedTime(order);\r\n                                const statusColor = getStatusColor(elapsed);\r\n\r\n                                return (\r\n                                    <div key={order.id} className={`bg-white rounded-2xl shadow-sm border-2 flex flex-col overflow-hidden transition-all hover:shadow-md ${order.status === 'Pending' ? 'border-yellow-400' : 'border-blue-500'}`}>\r\n                                        {/* Card Header */}\r\n                                        <div className={`p-4 flex justify-between items-start border-b ${statusColor}`}>\r\n                                            <div>\r\n                                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                                    <span className=\"font-bold text-lg\">#{order.id.toString().slice(-4)}</span>\r\n                                                    <span className=\"text-[10px] uppercase font-bold px-2 py-0.5 bg-white/50 rounded\">{order.type}</span>\r\n                                                </div>\r\n                                                <div className=\"text-xs font-mono opacity-80\">{order.time}</div>\r\n                                            </div>\r\n                                            <div className=\"text-right\">\r\n                                                <div className=\"text-2xl font-bold leading-none\">{elapsed}m</div>\r\n                                                <div className=\"text-[10px] uppercase font-bold opacity-80\">{order.status === 'Cooking' ? 'Cooking' : 'Waiting'}</div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Items */}\r\n                                        <div className=\"p-4 flex-1 space-y-3\">\r\n                                            {order.items.map((item: string, idx: number) => (\r\n                                                <div key={idx} className=\"flex items-start gap-3 text-lg font-bold text-gray-800\">\r\n                                                    <span className=\"mt-1.5 w-2 h-2 rounded-full bg-gray-300 shrink-0\"></span>\r\n                                                    <span className=\"leading-tight\">{item}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n\r\n                                        {/* Actions */}\r\n                                        <div className=\"p-4 bg-gray-50 border-t flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => printKOT(order)}\r\n                                                className=\"p-3 bg-white border border-gray-200 rounded-xl text-gray-500 hover:bg-gray-100\"\r\n                                                title=\"Print KOT\"\r\n                                            >\r\n                                                üñ®Ô∏è\r\n                                            </button>\r\n                                            {order.status === 'Pending' ? (\r\n                                                <button\r\n                                                    onClick={() => updateStatus(order.id, 'Cooking')}\r\n                                                    className=\"flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-200 transition-all\"\r\n                                                >\r\n                                                    Start Cooking\r\n                                                </button>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={() => updateStatus(order.id, 'Ready')}\r\n                                                    className=\"flex-1 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold shadow-lg shadow-green-200 transition-all\"\r\n                                                >\r\n                                                    Mark Ready\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 animate-in\">\r\n                            {Object.entries(aggregatedItems).map(([item, count]) => (\r\n                                <div key={item} className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center text-center hover:shadow-md transition-all\">\r\n                                    <div className=\"text-5xl font-bold text-[var(--brand-primary)] mb-2\">{count}</div>\r\n                                    <div className=\"text-lg font-bold text-gray-800 leading-tight\">{item}</div>\r\n                                    <div className=\"mt-4 text-xs text-gray-400 uppercase tracking-wider font-bold\">To Prepare</div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}